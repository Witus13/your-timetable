<!-- There are plans to make this a public element -->

<link rel="import" href="/bower_components/polymer/polymer.html">

<dom-module id="yta-pager">
  <template>
    <style>
      :host {
        margin: 5px;
      }
      
      iron-selector {
        /* From https://github.com/PolymerElements/iron-flex-layout */
        display: -ms-inline-flexbox;
        display: -webkit-inline-flex;
        display: inline-flex;
      }
      
      iron-selector div {
        margin: 5px;
        border-radius: 5px;
        width: 10px;
        height: 10px;
        background-color: var(--paper-pager-color, white);
        opacity: var(--paper-pager-opacity, 0.7);
      }
      
      .dot {
        will-change: transform;
        display: none;
        position: absolute;
        border-radius: 5px;
        background-color: var(--paper-pager-color, white);
        transition: all 300ms cubic-bezier(0.4, 0.0, 0.2, 1);
      }
      
      div {
        transition: background-color 150ms cubic-bezier(0.4, 0.0, 0.2, 1);
      }
    </style>
    <iron-selector selected="[[selected]]">
      <template is="dom-repeat" items="[[items]]">
        <div index="[[index]]" on-tap="_onTap"></div> 
      </template>
    </iron-selector>
    <div class="dot"></div>
  </template>
  <script>
    Polymer({
      is: 'yta-pager',
      
      properties: {
        
        itemsCount: {
          type: Number,
          notify: true,
          value: 0,
          observer: '_computeItems'
        },
        
        items: {
          type: Array,
          notify: true
        },
        
        selected: {
          type: Number,
          notify: true,
          reflectToAttribute: true,
          value: 0,
          observer: '_selectedChanged'
        }
        
      },
      
      listeners: {
        'dom-change': '_domRendered'
      },
      
      _onTap: function(e) {
        this.selected = e.target.index;
        //..
      },
      
      _computeItems: function(count) {
        this.items = new Array(count)
      },
      
      _domRendered: function() {
        if(this.selected == 0) {
          this._selectedChanged(this.selected, 2)
        } else {
          this._selectedChanged(this.selected, 0)
        }
      },
      
      _selectedChanged: function(selected, lastSelected) {
        var dot = this.$$('.dot').style;
        if(this.items.length && selected != lastSelected) {
          dot.display = 'block';
          var selectedN = selected + 1;
          var lastSelectedN = lastSelected + 1;
          var selectedItem = this.$$('div:nth-child(' + selectedN + ')');
          var lastSelectedItem = this.$$('div:nth-child(' + lastSelectedN + ')');
          dot.top = lastSelectedItem.offsetTop + 'px';
          dot.bottom = offsetBottom(lastSelectedItem, this) + 'px';
          dot.left = lastSelectedItem.offsetLeft + 'px';
          dot.right = offsetRight(lastSelectedItem, this) + 'px';
          if(lastSelected > selected) {
            dot.left = selectedItem.offsetLeft + 'px';
            dot.right = offsetRight(lastSelectedItem, this) + 'px';
          } else {
            dot.left = lastSelectedItem.offsetLeft + 'px';
            dot.right = offsetRight(selectedItem, this) + 'px';
          };
          this.async(function() {
            dot.left = selectedItem.offsetLeft + 'px';
            dot.right = offsetRight(selectedItem, this) + 'px';
          }.bind(this), 400)
        }
      }
    })
    
    // Nescessary ones
    function offsetBottom(item, root) {
      var elemHeight = item.offsetHeight;
      var elemTop = item.offsetTop;
      var rootHeight = root.offsetHeight;
      return rootHeight - (elemTop + elemHeight);
    }
    function offsetRight(item, root) {
      var elemWidth = item.offsetWidth;
      var elemLeft = item.offsetLeft;
      var rootWidth = root.offsetWidth;
      return rootWidth - (elemLeft + elemWidth);
    }
  </script>
</dom-module>
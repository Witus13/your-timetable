<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/polymer/lib/elements/dom-repeat.html">

<link rel="import" href="/bower_components/paper-styles/paper-styles.html">

<link rel="import" href="app-localize-behavior-mixin.html">

<dom-module id="yta-timetable-page">
  <template>
    <style>
      
      :host, #topPlaceholder {
        overflow-y: visible;
        position: relative;
      }
      
      #topPlaceholder {
        @apply --layout-horizontal;
        @apply --layout-wrap;
      }
      
      .dayPlaceholder {
        min-width: 300px;
      }
      
      .lesson {
        @apply --layout-vertical;
        @apply --layout-center-justified;
        border-bottom: 1px solid rgba(0,0,0,0.12);
        border-left-style: solid;
        border-left-width: 3px;
        height: 60px;
        padding-left: 13px;
      }
      
      .day-name {
        @apply --paper-font-menu;
        color: #fbc02d;
        margin: 8px 0 8px 16px;
      }
      
      p.secondary {
        @apply --paper-font-body1;
        color: var(--secondary-text-color);
      }
      
      p {
        margin: 0 2px; 
      }
      
      @media (min-width: 480px) and (max-width: 960px) and (orientation: landscape), (min-width: 0px) and (max-width: 600px) and (orientation: portrait) {
        
        .dayPlaceholder {
          min-width: calc(100vw - 3px);
        }
        
        .lesson {
          height: 70px;
        }
        
      }
      
      @media (min-width: 961px) and (orientation: landscape), (min-width: 601px) and (orientation: portrait) {
        
        .dayPlaceholder {
          @apply --layout-flex;
        }
        
      }
    
    </style>
    
    <div id="topPlaceholder">
      <template is="dom-repeat" items="[[data.timetable]]">
        <div class="dayPlaceholder">
          <h6 class="day-name">[[_computeDayName(index)]]</h6>
          <div class="lessonsPlaceholder">
            <dom-repeat items="[[item]]" as="lesson">
              <template>
                <div class="lesson" style="border-left-color: [[_pickLessonColor(lesson.name)]];">
                  <p>[[lesson.name]]</p>
                  <p class="secondary">[[viewReadable(lesson.startTime)]] - [[viewReadable(lesson.endTime)]]</p>
                </div>
              </template>
            </dom-repeat>
          </div>
        </div>
      </template>
    </div>
    <div id="spacer"></div>
  </template>
  
  <script>
    class TimetablePage extends Polymer.AppLocalizeBehaviorMixin(Polymer.Element) {
      static get is() { return 'yta-timetable-page'; }
      static get properties() {
        return {
          
          // Inherited from MainView
          data: {
            type: Object,
            notify: true
          }
          
        };
      }
      
      constructor() {
        super();
      }
      
      connectedCallback() {
        super.connectedCallback();
        
        // Set scroll target
        this.scrollTarget = document.body;
      }
      
      viewReadable(time) {
        const date = new Date(time);
        let hours = date.getUTCHours(),
            minutes = date.getUTCMinutes(),
            pm = false;
        if (this.data.settings.use12hoursClock && hours > 12) {
          hours -= 12;
          pm = true;
        }
        if (minutes.toString().length === 1) minutes = '0' + minutes;
        let output = hours + ':' + minutes;
        if (this.data.settings.use12hoursClock) {
          output += pm ? ' PM' : ' AM'; 
        }
        return output;
      }
      
      _computeDayName(day) {
        switch (this.data.settings.firstDayOfWeek) {
          case 1:
            day = day == 6 ? 0 : day + 1;
            break;
          case 6:
            day = day == 0 ? 6 : day - 1;
        }
        return this.localize('weekDays', 'd', day);
      }
      
      _pickLessonColor(name) {
        let config = this.data.config;
        return config[name].color;
      }
      
      _pickClassroom(name) {
        let config = this.data.config;
        return config[name].class;
      }
    }
    
    customElements.define(TimetablePage.is, TimetablePage);
  </script>
</dom-module>
<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<link rel="import" href="../bower_components/neon-animation/neon-animations.html"><!-- Pick only nescessary ones -->
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">

<link rel="import" href="yta-main-view.html">

<dom-module id="yta-shell">
  <template>
    <style>
      
      :host {
        /* --paper-font-common-base */
        font-family: 'Roboto', 'Noto', sans-serif;
        -webkit-font-smoothing: antialiased;
        /* Turn off selection */
        -moz-user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
        user-select: none;
      }
      
      neon-animated-pages, neon-animated-pages > * {
        /* --layout-fit */
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
      
    </style>
    
    <app-location route="{{route}}" use-hash-as-path></app-location>
    <app-route route="{{route}}"
               pattern="/:page"
               data="{{routeData}}"
               tail="{{tail}}"></app-route>
    
    <iron-media-query query="(min-width: 480px) and (max-width: 960px) and (orientation: landscape), (min-width: 0px) and (max-width: 600px) and (orientation: portrait)"
                      query-matches="{{phoneLayout}}"></iron-media-query>
    
    <neon-animated-pages selected="[[selected]]" attr-for-selected="key">
      <yta-main-view key="main"
                     phone-layout="[[phoneLayout]]"
                     data="{{appData}}"
                     style="display:block!important"></yta-main-view>
      <yta-settings key="settings"></yta-settings>
      <yta-onboarding key="onboarding" phone-layout="[[phoneLayout]]"></yta-onboarding>
      <yta-add-dialog key="add"
                      app-data="{{appData}}"
                      phone-layout="[[phoneLayout]]"></yta-add-dialog>
      <yta-feedback-dialog key="feedback"></yta-feedback-dialog>
    </neon-animated-pages>
  </template>
  
  <script>
    Polymer({
      is: 'yta-shell',
      
      behaviors: [
        Polymer.IronResizableBehavior,
        //Polymer.IronBooleanBehavior # Think of adding something like this
      ],
      
      properties: {
        
        selected: {
          type: String,
          notify: true,
          value: 'main'
        },
        
        appData: {
          type: Object,
          notify: true
        },
        
        // Layout indicators
        
        phoneLayout: {
          type: Boolean,
          notify: true
        },
        
        /* @note
        This layout is not going to be used until later release
        */
        tabletLayout: {
          type: Boolean,
          notify: true,
          value: false // To be removed - only for testing
        },
        
        desktopLayout: {
          type: Boolean,
          notify: true,
          computed: 'isFalse(phoneLayout, tabletLayout)'
        }
        
      },
      
      listeners: {
        'switch-page': 'switchRoute'
      },
      
      observers: [
        'resolveRoute(routeData.page)'
      ],
      
      attached: function() {
        shell = this;
        if(!this.route.path) {
          this.set('route.path', '/app')
        };
      },
      
      switchRoute: function(e) {
        switch (e.detail.action) {
          case 'openAddDialog':
            addDialog.isActive = true;
            addDialog.$.dialog.open();
            this.selected = 'add';
            this.set('routeData.page', 'add');
            break;
          case 'closeAddDialog':
            addDialog.$.dialog.close();
            this.selected = 'main';
            this.set('routeData.page', 'app');
            break;
          case 'openOnboarding':
            this.importHref('src/yta-onboarding.html', function() {
              onboarding.open()
              this.selected = 'onboarding';
              this.set('routeData.page', 'welcome');
            }, null, true);
            break;
          case 'closeOnboarding':
            onboarding.close();
            this.selected = 'main';
            this.set('routeData.page', 'app');
            break;
          default:
            throw('`switch-page` event fired without or with unknown action!')
        }
      },
      
      resolveRoute: function(toPage) {
        if(toPage == 'app') {
          if(addDialog.isActive) {
            this.set('routeData.page', 'add');
            addDialog.$.dialog.fire('iron-overlay-canceled', 'page redirect', { cancelable: true });
          } else if(onboarding.isActive) {
            this.set('routeData.page', 'welcome');
          }
        };
        /*if(toPage != 'app') {
          if(toPage == 'calendar') {
            console.log('Open calendar')
            //Open calendar tab of main-view                                    // Important!!!
          } else if(!(addDialog || onboarding) || (!addDialog.isActive && !onboarding.isActive)) {
            console.log('Navigate to /app')
            this.set('routeData.page', 'app')
          }
          console.log('Function executed')
        }*/
      },
      
      // To bo moved to behavior
      
      isFalse: function(arg1, arg2) {
        if(!arg1 && !arg2) {
          return true
        } else {
          return false
        }
      }
    })
  </script>
</dom-module>
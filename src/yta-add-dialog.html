<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/app-datepicker/app-datepicker-dialog.html">

<!--<link rel="import" href="../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">-->
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">

<link rel="import" href="../bower_components/neon-animation/neon-animations.html"><!-- Pick only nescessary ones -->
<link rel="import" href="../bower_components/neon-animation/neon-shared-element-animatable-behavior.html">

<link rel="import" href="../bower_components/vaadin-combo-box/vaadin-combo-box.html">

<link rel="import" href="yta-common-styles.html">

<dom-module id="yta-add-dialog">
  <template>
    <style include="yta-common-styles">
      @media (min-width: 0px) and (max-width: 600px) and (orientation: portrait), (min-width: 480px) and (max-width: 960px) and (orientation: landscape) {
        
        
      /*
       * Phone styles
       */
        
        
        /*#dialog {
          @apply(--layout-fit);
          background-color: rgba(0,0,0,0) !important;
        }*/
        
      }
      
      #content {
        /*@apply(--layout-fit);*/
        background-color: white;
      }
      
      app-toolbar {
        background-color: var(--paper-yellow-500);
        color: rgba(0,0,0,0.87);
      }
      
    </style>
    
    <paper-dialog id="dialog" with-backdrop>
      <h2>Add to calendar</h2>
      <paper-dialog-scrollable>
        <template is="dom-repeat" items="{{data}}">
          <div>
            <paper-dropdown-menu label="What would you like to add?">
              <paper-listbox attr-for-selected="key" selected="{{item.type}}" class="dropdown-content">
                <paper-item key="change">Change in plan</paper-item>
                <paper-item key="test">Test</paper-item>
                <paper-item key="reminder">Reminder</paper-item>
              </paper-listbox>
            </paper-dropdown-menu>
            <br>
            <template is="dom-if" if="{{_isChangeSelected(item.type)}}">
              <paper-checkbox checked="{{item.pernament}}">Pernament change</paper-checkbox><br>
              <p on-tap="collapseFrom">Change from</p>
              <iron-collapse class="from">
                <div>
                  
                  <vaadin-combo-box>
                    <!-- Notice the class="input" -->
                    <paper-input label="Lesson" no-label-float class="input">
                      <!-- Notice the class="selected-items" (selected Items/chips/tokens will be rendered here) -->
                      <div class="selected-items" prefix></div>
                      <!-- Notice the class="toggle-button" -->
                      <!--<paper-icon-button icon="clear" suffix class="toggle-button"></paper-icon-button>-->
                    </paper-input>
                    <!-- Notice the class="overlay-item" -->
                    <!--<template class="overlay-item">
                      <paper-icon-item>
                        <div class="avatar blue" item-icon></div>
                        <paper-item-body two-line>
                          <div>[[item.name]]</div>
                          <div secondary>[[item.email]]</div>
                        </paper-item-body>
                      </paper-icon-item>
                    </template>-->
                    <!-- Notice the class="selected-item" -->
                    <!--<template class="selected-item">
                      <paper-chip>[[item.name]]</paper-chip>
                    </template>-->
                  </vaadin-combo-box>
                </div>
              </iron-collapse>
            </template>
          </div>
        </template>
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button dialog-dismiss>Discard</paper-button>
        <paper-button dialog-confirm>Save</paper-button>
      </div>
    </paper-dialog>
    
    <app-datepicker-dialog id="datepicker"
                           show-long-date
                           disable-days="{{_computeIgnoredDays(appData.timetable)}}"></app-datepicker-dialog>
    
    <paper-dialog id="cancel">
      <p>Discard edits?</p>
      <div class="buttons">
        <paper-button dialog-dismiss>Discard</paper-button>
        <paper-button dialog-confirm>Keep editing</paper-button>
      </div>
    </paper-dialog>
  </template>
  
  <script>
    Polymer({
      is: 'yta-add-dialog',
      
      behaviors: [
        Polymer.NeonSharedElementAnimatableBehavior,
        Polymer.IronResizableBehavior
      ],
      
      properties: {
        
        data: {
          type: Object,
          notify: true,
          reflectToAttribute: true,
          value: function() { return [ {
            type: 'change',
            name: null,
            lesson: { day: null, number: null },
            reminder: false,
            subject: null,
            pernament: false,
          } ] }
        },
        
        appData: {
          type: Object,
          notify: true
        },
        
        phoneLayout: {
          type: Boolean,
          notify: true,
          observer: '_onPhoneLayoutChanges'
        },
        
        isActive: {
          type: Boolean,
          value: false
        }
        
        /*animationConfig: {
          value: function() { return {
            'entry': null,
            'exit': null
          } }
        },
        
        sharedElements: {
          value: function() { return {
            'hero': this.$.dialog
          } }
        }*/
        
      },
      
      listeners: {
        //'iron-resize': 'setLayout', // To set the layout when screen size changes
        'dialog.iron-overlay-canceled': '_onDialogCanceled'
      },
      
      attached: function() {
        addDialog = this;
        this.$.cancel.animationConfig = {
          'entry': [
            {
              name: 'slide-from-bottom-animation',
              node: this.$.cancel,
              timing: {
                duration: 225,
                easing: 'cubic-bezier(0.0, 0.0, 0.2, 1)'
              }
            },
            {
              name: 'fade-in-animation',
              node: this.$.cancel,
              timing: {
                duration: 225,
                easing: 'cubic-bezier(0.0, 0.0, 0.2, 1)'
              }
            }
          ],
          'exit': [
            {
              name: 'slide-down-animation',
              node: this.$.cancel,
              timing: {
                duration: 195,
                easing: 'cubic-bezier(0.4, 0.0, 1, 1)'
              }
            },
            {
              name: 'fade-out-animation',
              node: this.$.cancel,
              timing: {
                duration: 195,
                easing: 'cubic-bezier(0.4, 0.0, 1, 1)'
              }
            }
          ],
        };
      },
      
      _isChangeSelected: function(selected) {
        if(selected == 'change') {
          return true
        }
      },
      
      collapseFrom: function() {
        this.$$('iron-collapse.from').toggle();
      },
      
      _computeIgnoredDays: function(timetable) {
        var output = [0,1,2,3,4,5,6];
        for(var i = 0; i < timetable.length; i++) {
          if(i == 6) {
            output.splice(0, 1)
          } else {
            output.splice(1, 1)
          }
        };
        return output
      },
      
      _onDialogCanceled: function(e) {
        if(e.target == this.$.dialog) {
          e.preventDefault();
          this.$.cancel.open();
          this.listen(this.$.cancel, 'iron-overlay-closed', '_onCancelClosed');
        }
      },
      
      _onCancelClosed: function(e) {
        if(!e.detail.confirmed) {
          this.isActive = false;
          this.fire('switch-page', { action: 'closeAddDialog' });
        }
      },
      
      _onPhoneLayoutChanges: function(phoneLayout) {
        if(phoneLayout) {
          
        }
      }
    })
  </script>